# Remediating Security Issues Discovered by GuardDuty<a name="guardduty_remediate"></a>

Amazon GuardDuty generates [findings](guardduty_findings.md) that indicate potential security issues\. In this release of GuardDuty, the potential security issues indicate either a compromised EC2 instance or a set of compromised credentials in your AWS environment\. The following sections describe the recommended remediation steps for these scenarios\. If there are alternative remediation scenarios they will be described in the entry for that specific finding type\. You can access the full information about a finding type by selecting it from the [Active Findings Table](guardduty_finding-types-active.md)\.

**Topics**
+ [Remediating a Compromised EC2 Instance](#compromised-ec2)
+ [Remediating Compromised AWS Credentials](#compromised-creds)

## Remediating a Compromised EC2 Instance<a name="compromised-ec2"></a>

Follow these recommended steps to remediate a compromised EC2 instance in your AWS environment:
+ Investigate the potentially compromised instance for malware and remove any discovered malware\. You can also refer to the [AWS Marketplace](https://aws.amazon.com/marketplace) for partner products that might help to identify and remove malware\.
+ If you are unable to identify and stop unauthorized activity on your EC2 instance, we recommend that you terminate the compromised EC2 instance and replace it with a new instance as needed\. The following are additional resources for securing your EC2 instances:
  + "Security and Network" section in [Best Practices for Amazon EC2](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-best-practices.html)\.
  + [Amazon EC2 Security Groups for Linux Instances](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html) and [Amazon EC2 Security Groups for Windows Instances](https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/using-network-security.html)\.
  + [Tips for securing your EC2 instances \(Linux\)](http://aws.amazon.com/articles/tips-for-securing-your-ec2-instance/)\.
  + [AWS Security Best Practices](https://d0.awsstatic.com/whitepapers/Security/AWS_Security_Best_Practices.pdf)
+ Browse for further assistance on the AWS developer forums: [https://forums\.aws\.amazon\.com/index\.jspa](https://forums.aws.amazon.com/index.jspa) 
+ If you are a Premium Support package subscriber, you can submit a [technical support](https://console.aws.amazon.com/support/home#/case/create?issueType=technical) request\. 

## Remediating Compromised AWS Credentials<a name="compromised-creds"></a>

Follow these recommended steps to remediate compromised credentials in your AWS environment:

1. **Identify the affected IAM entity and the API call used\.** 

   The API call used will be listed as `API` in the finding details\. The IAM entity \(either an IAM user or role\) and it's identifying information will be listed in the **Resource** section of a finding's details\. The type of IAM entity involved can be determined by the **User Type** field, the name of the IAM entity will be in the **User name** field\. The type of IAM entity involved in the finding can also be determined by the **Access key ID** used\.  
For keys beginning with `AKIA`:  
This type of key is a long term customer\-managed credential associated with an IAM user or AWS account root user\. For information on managing access keys for IAM users see [Managing Access Keys for IAM Users](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html)\.  
For keys beginning with `ASIA`:  
This type of key is a short term temporary credential generated by AWS Security Token Service\. These keys exists for only a short time and cannot be viewed or managed in the AWS Management Console\. IAM roles will always use AWS STS credentials, but they can also be generated for IAM Users, for more information on AWS STS see [IAM: Temporary Security Credentials](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html#sts-introduction)\.  
If a role was used the **User name** field will contain information about the name of the role used\. You can determine how the key was requested with AWS CloudTrail by examining the `sessionIssuer` element of the CloudTrail log entry, for more information see [IAM and AWS STS Information in CloudTrail](https://docs.aws.amazon.com/IAM/latest/UserGuide/cloudtrail-integration.html#iam-info-in-cloudtrail)\.

1. **Review permissions for the IAM entity\.**

   Open the IAM console, depending on the type of entity used, choose the **Users** or **Roles** tab, and locate the affected entity by typing the identified name into the search field\. Use the **Permission** and **Access Advisor** tabs to review effective permissions for that entity\.

1. **Determine whether the IAM entity credentials were used legitimately\.**

   Contact the user of the credentials to determine if the activity was intentional\.

   For example, find out if the user did the following:
   + Invoked the API operation that was listed in the GuardDuty finding
   + Invoked the API operation at the time that is listed in the GuardDuty finding
   + Invoked the API operation from the IP address that is listed in the GuardDuty finding

If you confirm that the activity is a legitimate use of the AWS credentials, you can ignore the GuardDuty finding\. If not, this activity could be the result of a compromise to that particular access key, the IAM user's user ID and password, or possibly the entire AWS account\. If you suspect your credentials have been compromised, review the information in the[My AWS account may be compromised](https://aws.amazon.com/premiumsupport/knowledge-center/potential-account-compromise/) article to remediate the issue\.